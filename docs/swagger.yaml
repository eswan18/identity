basePath: /
definitions:
  httpserver.CreateUserRequest:
    properties:
      email:
        type: string
      password:
        type: string
      username:
        type: string
    type: object
  httpserver.CreateUserResponse:
    properties:
      created_at:
        type: string
      email:
        type: string
      email_verified:
        type: boolean
      id:
        type: string
      is_active:
        type: boolean
      username:
        type: string
    type: object
  httpserver.ListUsersResponse:
    properties:
      has_more:
        type: boolean
      limit:
        type: integer
      offset:
        type: integer
      total:
        type: integer
      users:
        items:
          $ref: '#/definitions/httpserver.UserResponse'
        type: array
    type: object
  httpserver.TokenResponse:
    properties:
      access_token:
        type: string
      expires_in:
        type: integer
      refresh_token:
        type: string
      scope:
        type: string
      token_type:
        type: string
    type: object
  httpserver.UserResponse:
    properties:
      created_at:
        type: string
      email:
        type: string
      email_verified:
        type: boolean
      id:
        type: string
      is_active:
        type: boolean
      mfa_enabled:
        type: boolean
      updated_at:
        type: string
      username:
        type: string
    type: object
host: localhost:8080
info:
  contact:
    name: Ethan Swan
  title: Identity Service
  version: "1.0"
paths:
  /:
    get:
      description: Redirects to account settings if logged in, or login page if not
      responses:
        "302":
          description: Redirect to appropriate page
          schema:
            type: string
      summary: Root redirect
      tags:
      - navigation
  /.well-known/openid-configuration:
    get:
      description: Returns OpenID Connect Provider Configuration (RFC 8414). Allows
        clients to discover all necessary endpoints and provider capabilities.
      produces:
      - application/json
      responses:
        "200":
          description: OIDC provider configuration
          schema:
            additionalProperties: true
            type: object
      summary: OIDC Discovery endpoint
      tags:
      - oauth2
  /account-settings:
    get:
      description: Displays the account settings page where users can view their account
        info and change their password
      produces:
      - text/html
      responses:
        "200":
          description: HTML account settings page
          schema:
            type: string
        "401":
          description: Unauthorized - no valid session
          schema:
            type: string
      summary: Show account settings page
      tags:
      - account
  /admin/users:
    get:
      description: Returns a paginated list of all users. Requires admin:users:read
        scope.
      parameters:
      - description: Number of users to return (default 20, max 100)
        in: query
        name: limit
        type: integer
      - description: Number of users to skip (default 0)
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of users
          schema:
            $ref: '#/definitions/httpserver.ListUsersResponse'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Insufficient scope
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: List all users (Admin API)
      tags:
      - admin
    post:
      consumes:
      - application/json
      description: Creates a new user account. Requires admin:users:write scope.
      parameters:
      - description: User creation request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/httpserver.CreateUserRequest'
      produces:
      - application/json
      responses:
        "201":
          description: User created successfully
          schema:
            $ref: '#/definitions/httpserver.CreateUserResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Insufficient scope
          schema:
            additionalProperties:
              type: string
            type: object
        "409":
          description: Username or email already exists
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Create a new user (Admin API)
      tags:
      - admin
  /admin/users/{id}:
    get:
      description: Returns a single user by their ID. Requires admin:users:read scope.
      parameters:
      - description: User ID (UUID)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: User details
          schema:
            $ref: '#/definitions/httpserver.UserResponse'
        "400":
          description: Invalid user ID
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Insufficient scope
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: User not found
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get a user by ID (Admin API)
      tags:
      - admin
  /change-email:
    get:
      description: Displays the change email form
      produces:
      - text/html
      responses:
        "200":
          description: HTML change email page
          schema:
            type: string
        "401":
          description: Unauthorized - no valid session
          schema:
            type: string
      summary: Show change email page
      tags:
      - account
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Processes email change form submission
      parameters:
      - description: New email address
        in: formData
        name: new_email
        required: true
        type: string
      - description: Password for verification
        in: formData
        name: password
        required: true
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML change email page with success message
          schema:
            type: string
        "400":
          description: Invalid request
          schema:
            type: string
        "401":
          description: Unauthorized - invalid password
          schema:
            type: string
      summary: Update email
      tags:
      - account
  /change-password:
    get:
      description: Displays the change password form
      produces:
      - text/html
      responses:
        "200":
          description: HTML change password page
          schema:
            type: string
        "401":
          description: Unauthorized - no valid session
          schema:
            type: string
      summary: Show change password page
      tags:
      - account
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Processes password change form submission
      parameters:
      - description: Current password for verification
        in: formData
        name: current_password
        required: true
        type: string
      - description: New password
        in: formData
        name: new_password
        required: true
        type: string
      - description: Confirm new password
        in: formData
        name: confirm_password
        required: true
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML change password page with success message
          schema:
            type: string
        "400":
          description: Invalid request - passwords don't match
          schema:
            type: string
        "401":
          description: Unauthorized - invalid current password
          schema:
            type: string
      summary: Update password
      tags:
      - account
  /change-username:
    get:
      description: Displays the change username form
      produces:
      - text/html
      responses:
        "200":
          description: HTML change username page
          schema:
            type: string
        "401":
          description: Unauthorized - no valid session
          schema:
            type: string
      summary: Show change username page
      tags:
      - account
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Processes username change form submission
      parameters:
      - description: New username
        in: formData
        name: new_username
        required: true
        type: string
      - description: Password for verification
        in: formData
        name: password
        required: true
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML change username page with success message
          schema:
            type: string
        "400":
          description: Invalid request
          schema:
            type: string
        "401":
          description: Unauthorized - invalid password
          schema:
            type: string
      summary: Update username
      tags:
      - account
  /deactivate-account:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Deactivates the user's account by setting is_active to false
      parameters:
      - description: Password for verification
        in: formData
        name: password
        required: true
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: Redirect to login page after deactivation
          schema:
            type: string
        "400":
          description: Invalid request
          schema:
            type: string
        "401":
          description: Unauthorized - invalid password
          schema:
            type: string
      summary: Deactivate user account
      tags:
      - account
  /forgot-password:
    get:
      description: Displays the forgot password form
      produces:
      - text/html
      responses:
        "200":
          description: HTML forgot password page
          schema:
            type: string
      summary: Show forgot password page
      tags:
      - authentication
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Sends a password reset email if the account exists
      parameters:
      - description: Email address
        in: formData
        name: email
        required: true
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML forgot password page with success message
          schema:
            type: string
      summary: Request password reset
      tags:
      - authentication
  /forgot-username:
    get:
      description: Displays the forgot username form
      produces:
      - text/html
      responses:
        "200":
          description: HTML forgot username page
          schema:
            type: string
      summary: Show forgot username page
      tags:
      - authentication
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Sends a username reminder email if the account exists
      parameters:
      - description: Email address
        in: formData
        name: email
        required: true
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML forgot username page with success message
          schema:
            type: string
      summary: Request username reminder
      tags:
      - authentication
  /health:
    get:
      description: Returns service health status including database connectivity
      produces:
      - application/json
      responses:
        "200":
          description: Service is healthy
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Health check
      tags:
      - health
  /login:
    get:
      description: Displays the login form with OAuth parameters preserved in hidden
        fields
      parameters:
      - description: Registered client identifier
        in: query
        name: client_id
        required: true
        type: string
      - description: Where to send the user after auth
        in: query
        name: redirect_uri
        required: true
        type: string
      - description: CSRF protection token
        in: query
        name: state
        required: true
        type: string
      - description: Requested scopes (e.g., 'openid profile email')
        in: query
        name: scope
        required: true
        type: string
      - description: PKCE code challenge (SHA256 hash)
        in: query
        name: code_challenge
        required: true
        type: string
      - description: PKCE challenge method (must be 'S256')
        in: query
        name: code_challenge_method
        required: true
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML login page
          schema:
            type: string
      summary: Show login page
      tags:
      - authentication
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Validates username/password, creates authenticated session, generates
        authorization code, and redirects to client
      parameters:
      - description: User username
        in: formData
        name: username
        required: true
        type: string
      - description: User password
        in: formData
        name: password
        required: true
        type: string
      - description: OAuth client ID
        in: formData
        name: client_id
        required: true
        type: string
      - description: OAuth redirect URI
        in: formData
        name: redirect_uri
        required: true
        type: string
      - description: CSRF protection token
        in: formData
        name: state
        required: true
        type: string
      - description: Requested scopes
        in: formData
        name: scope
        required: true
        type: string
      - description: PKCE code challenge
        in: formData
        name: code_challenge
        required: true
        type: string
      - description: PKCE challenge method
        in: formData
        name: code_challenge_method
        required: true
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: Redirect to redirect_uri with authorization code
          schema:
            type: string
        "400":
          description: Invalid request parameters
          schema:
            type: string
        "401":
          description: Invalid credentials
          schema:
            type: string
      summary: Process login
      tags:
      - authentication
  /logout:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Invalidates user session and refresh tokens, then redirects to
        logout URI or default page
      parameters:
      - description: Where to redirect after logout
        in: query
        name: post_logout_redirect_uri
        type: string
      - description: State to include in redirect
        in: query
        name: state
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: Redirect to logout URI or default page
          schema:
            type: string
        "400":
          description: Invalid request
          schema:
            type: string
      summary: Logout user
      tags:
      - authentication
  /oauth/authorize:
    get:
      description: Validates OAuth2 parameters, checks if user is authenticated (via
        session cookie), renders login page if not authenticated, or generates authorization
        code and redirects to redirect_uri if authenticated
      parameters:
      - description: Must be 'code'
        in: query
        name: response_type
        required: true
        type: string
      - description: Registered client identifier
        in: query
        name: client_id
        required: true
        type: string
      - description: Where to send the user after auth
        in: query
        name: redirect_uri
        required: true
        type: string
      - description: Requested scopes (e.g., 'openid profile email'). Defaults to
          'openid' if not provided.
        in: query
        name: scope
        type: string
      - description: CSRF protection token. Recommended for OAuth flow.
        in: query
        name: state
        type: string
      - description: PKCE code challenge (SHA256 hash). Required for OAuth flow.
        in: query
        name: code_challenge
        type: string
      - description: PKCE challenge method (must be 'S256'). Required for OAuth flow.
        in: query
        name: code_challenge_method
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: Redirect to redirect_uri with error parameters
          schema:
            type: string
      summary: OAuth2 authorization endpoint
      tags:
      - oauth2
  /oauth/introspect:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Returns metadata about a token (validity, scopes, expiration, etc.)
        per RFC 7662. This is different from /userinfo which returns user identity
        - introspect returns token information.
      parameters:
      - description: The token to introspect (access token or refresh token)
        in: formData
        name: token
        required: true
        type: string
      - description: 'Hint about the token type: ''access_token'' or ''refresh_token'''
        in: formData
        name: token_type_hint
        type: string
      - description: OAuth client ID
        in: formData
        name: client_id
        required: true
        type: string
      - description: OAuth client secret
        in: formData
        name: client_secret
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Token introspection response with 'active' (boolean), 'scope',
            'exp', 'iat', 'sub', etc.
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized - invalid client credentials
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Token introspection endpoint
      tags:
      - oauth2
  /oauth/refresh:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Exchanges a refresh token for new access and refresh tokens
      parameters:
      - description: Refresh token to exchange
        in: formData
        name: refresh_token
        required: true
        type: string
      - description: OAuth client ID
        in: formData
        name: client_id
        required: true
        type: string
      - description: OAuth client secret (required for confidential clients)
        in: formData
        name: client_secret
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Token response with access_token, token_type, expires_in, refresh_token,
            and scope
          schema:
            $ref: '#/definitions/httpserver.TokenResponse'
        "400":
          description: OAuth2 error response (invalid_request, invalid_grant, invalid_client,
            etc.)
          schema:
            additionalProperties:
              type: string
            type: object
      summary: OAuth2 refresh token endpoint
      tags:
      - oauth2
  /oauth/revoke:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Revokes a specific access token or refresh token per RFC 7009.
        This is more granular than /logout which invalidates all user tokens - revoke
        can invalidate individual tokens.
      parameters:
      - description: The token to revoke (access token or refresh token)
        in: formData
        name: token
        required: true
        type: string
      - description: 'Hint about the token type: ''access_token'' or ''refresh_token'''
        in: formData
        name: token_type_hint
        type: string
      - description: OAuth client ID
        in: formData
        name: client_id
        required: true
        type: string
      - description: OAuth client secret
        in: formData
        name: client_secret
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Token revoked successfully
          schema:
            type: string
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized - invalid client credentials
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Token revocation endpoint
      tags:
      - oauth2
  /oauth/token:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Exchanges authorization code for access/refresh/ID tokens (with
        PKCE verification) or refreshes access token using refresh token
      parameters:
      - description: 'Grant type: ''authorization_code'' or ''refresh_token'''
        in: formData
        name: grant_type
        required: true
        type: string
      - description: Authorization code (required for authorization_code grant)
        in: formData
        name: code
        type: string
      - description: Redirect URI (required for authorization_code grant)
        in: formData
        name: redirect_uri
        type: string
      - description: OAuth client ID
        in: formData
        name: client_id
        required: true
        type: string
      - description: OAuth client secret
        in: formData
        name: client_secret
        required: true
        type: string
      - description: PKCE code verifier (required for authorization_code grant)
        in: formData
        name: code_verifier
        type: string
      - description: Refresh token (required for refresh_token grant)
        in: formData
        name: refresh_token
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Token response with access_token, token_type, expires_in, refresh_token,
            id_token, and scope
          schema:
            additionalProperties: true
            type: object
        "400":
          description: OAuth2 error response (invalid_request, invalid_grant, invalid_client,
            etc.)
          schema:
            additionalProperties:
              type: string
            type: object
      summary: OAuth2 token endpoint
      tags:
      - oauth2
  /oauth/userinfo:
    get:
      description: Returns user profile claims (sub, username, email, email_verified)
        for the authenticated user. This endpoint provides user identity information,
        not token metadata.
      parameters:
      - description: Bearer access token
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: User profile claims (sub, username, email, email_verified)
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized - invalid or missing access token
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: OIDC UserInfo endpoint
      tags:
      - oidc
  /reactivate-account:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Reactivates the user's account by setting is_active to true
      parameters:
      - description: Password for verification
        in: formData
        name: password
        required: true
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: Redirect to account settings after reactivation
          schema:
            type: string
        "400":
          description: Invalid request
          schema:
            type: string
        "401":
          description: Unauthorized - invalid password
          schema:
            type: string
      summary: Reactivate user account
      tags:
      - account
  /register:
    get:
      description: Displays the registration form for creating a new user account.
        Accepts OAuth parameters to preserve them through the registration flow.
      parameters:
      - description: OAuth client identifier (preserved through flow)
        in: query
        name: client_id
        type: string
      - description: OAuth redirect URI (preserved through flow)
        in: query
        name: redirect_uri
        type: string
      - description: OAuth state parameter (preserved through flow)
        in: query
        name: state
        type: string
      - description: OAuth scope (preserved through flow)
        in: query
        name: scope
        type: string
      - description: PKCE code challenge (preserved through flow)
        in: query
        name: code_challenge
        type: string
      - description: PKCE challenge method (preserved through flow)
        in: query
        name: code_challenge_method
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML registration page
          schema:
            type: string
      summary: Show registration page
      tags:
      - authentication
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Creates a new user account with username, email, and password
      parameters:
      - description: Desired username
        in: formData
        name: username
        required: true
        type: string
      - description: User email address
        in: formData
        name: email
        required: true
        type: string
      - description: User password (min 8 characters)
        in: formData
        name: password
        required: true
        type: string
      - description: Password confirmation
        in: formData
        name: confirm_password
        required: true
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: Redirect to login page on success
          schema:
            type: string
        "400":
          description: Invalid request parameters or validation error
          schema:
            type: string
        "409":
          description: Username or email already exists
          schema:
            type: string
      summary: Register new user
      tags:
      - authentication
  /reset-password:
    get:
      description: Displays the reset password form for users who clicked a reset
        link
      parameters:
      - description: Password reset token
        in: query
        name: token
        required: true
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML reset password page
          schema:
            type: string
        "400":
          description: Invalid or expired token
          schema:
            type: string
      summary: Show reset password page
      tags:
      - authentication
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: Sets a new password using a valid reset token
      parameters:
      - description: Password reset token
        in: formData
        name: token
        required: true
        type: string
      - description: New password
        in: formData
        name: new_password
        required: true
        type: string
      - description: Confirm new password
        in: formData
        name: confirm_password
        required: true
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: Redirect to login page on success
          schema:
            type: string
        "400":
          description: Invalid token or password mismatch
          schema:
            type: string
      summary: Reset password
      tags:
      - authentication
  /success:
    get:
      description: Displays a success page after direct login (without OAuth redirect_uri),
        explaining how to access applications through OAuth flow
      produces:
      - text/html
      responses:
        "200":
          description: HTML success page
          schema:
            type: string
      summary: Login success page
      tags:
      - authentication
swagger: "2.0"
